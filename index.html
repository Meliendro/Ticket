<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Table Project</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f5; padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 6px 8px; border: 1px solid #ccc; font-size: 12px; }
    th { background: #f87171; color: white; font-weight: bold; text-align: center; }
    td { vertical-align: top; }
    select, input[type=text], input[type=date], textarea { width: 100%; font-size: 12px; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
    textarea { resize: vertical; }
    button { padding: 6px 12px; border-radius: 6px; font-weight: bold; }
    .btn-add { background: #34d399; color: white; margin-bottom: 10px; }
    .btn-save { background: #3b82f6; color: white; }
</style>
</head>
<body>

<h1 class="text-2xl font-bold mb-4">Ticket Table</h1>
<button class="btn-add" onclick="addTicket()">âž• Aggiungi Ticket</button>

<table id="ticketTable">
    <thead>
        <tr>
            <th>Nr.</th>
            <th>Stato</th>
            <th>Tipo</th>
            <th>Bloccante</th>
            <th>PrioritÃ </th>
            <th>Data Inserimento</th>
            <th>Ambito</th>
            <th>Menu</th>
            <th>Titolo</th>
            <th>Descrizione</th>
            <th>Inserito da</th>
            <th>In carico a</th>
            <th>Data inizio prevista</th>
            <th>Data fine prevista</th>
            <th>Data rilascio</th>
            <th>Descrizione attivitÃ  di soluzione</th>
            <th>Data Stato</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<button class="btn-save mt-4" onclick="saveTickets()">ðŸ’¾ Salva Ticket</button>

<script>
let ticketCount = 0;

function addTicket() {
    ticketCount++;
    const tbody = document.getElementById('ticketTable').querySelector('tbody');
    const row1 = document.createElement('tr');
    const row2 = document.createElement('tr'); // seconda riga per descrizione lunga

    const today = new Date().toISOString().split('T')[0];

    row1.innerHTML = `
        <td rowspan="2">${ticketCount}</td>
        <td><select onchange="updateStateDate(this)"><option>Segnalato</option><option>Preso in carico</option><option>Rilasciato</option><option>In Test</option><option>Completato</option></select></td>
        <td><select><option>Bug</option><option>Miglioria</option><option>Nuova richiesta</option></select></td>
        <td>
            <select>
                <option>Bloccante</option>
                <option>Non Bloccante</option>
            </select>
        </td>
        <td><select><option>Alta</option><option>Media</option><option>Bassa</option></select></td>
        <td><input type="date" value="${today}" readonly></td>
        <td><select><option>FASE1</option><option>FASE2</option><option>FASE3</option></select></td>
        <td><select><option>Pianificazione cantieri</option><option>Pianificazione squadre</option><option>Da segnalare</option></select></td>
        <td><input type="text"></td>
        <td></td> <!-- descrizione lunga sulla seconda riga -->
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
        <td></td>
        <td></td> <!-- Data stato riempita automaticamente -->
    `;

    row2.innerHTML = `
        <td colspan="2"><textarea rows="2" placeholder="Descrizione ticket..."></textarea></td>
        <td colspan="3"><textarea rows="2" placeholder="Descrizione attivitÃ  di soluzione..."></textarea></td>
        <td colspan="4"></td>
    `;

    tbody.appendChild(row1);
    tbody.appendChild(row2);
}

// Aggiorna la data corrispondente allo stato selezionato
function updateStateDate(select) {
    const row = select.closest('tr');
    const stateDateCell = row.cells[row.cells.length-1];
    stateDateCell.innerText = new Date().toLocaleDateString();
}

// Salvataggio in JSON
function saveTickets() {
    const tbody = document.getElementById('ticketTable').querySelector('tbody');
    const tickets = [];
    for (let i = 0; i < tbody.rows.length; i += 2) {
        const r1 = tbody.rows[i];
        const r2 = tbody.rows[i+1];
        const ticket = {
            nr: r1.cells[0].innerText,
            stato: r1.cells[1].querySelector('select').value,
            tipo: r1.cells[2].querySelector('select').value,
            bloccante: r1.cells[3].querySelector('select').value,
            priorita: r1.cells[4].querySelector('select').value,
            dataInserimento: r1.cells[5].querySelector('input').value,
            ambito: r1.cells[6].querySelector('select').value,
            menu: r1.cells[7].querySelector('select').value,
            titolo: r1.cells[8].querySelector('input').value,
            descrizione: r2.cells[0].querySelector('textarea').value,
            inseritoDa: r1.cells[10].querySelector('input').value,
            inCaricoA: r1.cells[11].querySelector('input').value,
            dataInizio: r1.cells[12].querySelector('input').value,
            dataFine: r1.cells[13].querySelector('input').value,
            dataRilascio: r1.cells[14].querySelector('input').value,
            descrizioneSoluzione: r2.cells[1].querySelector('textarea').value,
            dataStato: r1.cells[16].innerText
        };
        tickets.push(ticket);
    }
    console.log(JSON.stringify(tickets, null, 2));
    alert('Ticket salvati correttamente! Controlla console per JSON.');
}
</script>

</body>
</html>
