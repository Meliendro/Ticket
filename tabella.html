<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabella Ticket</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
th, td { border: 1px solid #ddd; padding: 0.5rem; font-size: 0.85rem; }
th { background-color: #3b82f6; color: white; }
button { background-color: #3b82f6; color:white; padding:0.3rem 0.5rem; border-radius:0.25rem; font-size:0.8rem; }
</style>
</head>
<body class="p-4">

<h1 class="text-xl font-bold">Elenco Ticket</h1>
<button onclick="apriInserimento()" class="mb-2">Nuovo Ticket</button>

<table id="ticketTable">
<thead>
<tr>
<th>Nr.</th>
<th>Stato</th>
<th>Tipo</th>
<th>Priorit√†</th>
<th>Data Inserimento</th>
<th>Ambito</th>
<th>Menu</th>
<th>Titolo</th>
<th>Descrizione</th>
<th>Inserito da</th>
<th>In carico a</th>
<th>Data inizio prevista</th>
<th>Data fine prevista</th>
<th>Data rilascio</th>
<th>Segnalato</th>
<th>Preso in carico</th>
<th>In Test</th>
<th>Rilasciato</th>
<th>Completato</th>
<th>Descrizione soluzione</th>
<th>Azioni</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

<script>
let tickets = [];
let ticketCounter = 1;

function apriInserimento(ticketIndex=null){
    let url = 'inserimento.html';
    if(ticketIndex !== null) url += '?edit=' + ticketIndex;
    window.open(url, 'popup', 'width=900,height=700');
}

function aggiornaTabella() {
    const tbody = document.querySelector('#ticketTable tbody');
    tbody.innerHTML = '';
    tickets.forEach((t,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
        <td>${t.nr_ticket}</td>
        <td>${t.stato}</td>
        <td>${t.tipo}</td>
        <td>${t.priorita}</td>
        <td>${t.data_inserimento}</td>
        <td>${t.ambito}</td>
        <td>${t.menu}</td>
        <td>${t.titolo}</td>
        <td>${t.descrizione}</td>
        <td>${t.inserito_da}</td>
        <td>${t.in_carico_a}</td>
        <td>${t.data_inizio_prevista}</td>
        <td>${t.data_fine_prevista}</td>
        <td>${t.data_rilascio}</td>
        <td>${t.data_segnalato||''}</td>
        <td>${t.data_preso_in_carico||''}</td>
        <td>${t.data_in_test||''}</td>
        <td>${t.data_rilasciato||''}</td>
        <td>${t.data_completato||''}</td>
        <td>${t.descrizione_soluzione}</td>
        <td><button onclick="apriInserimento(${i})">Modifica</button></td>
        `;
        tbody.appendChild(tr);
    });
}

// funzione per ricevere ticket dal popup
function riceviTicket(ticket, index=null) {
    if(index !== null){
        tickets[index] = ticket;
    } else {
        ticket.nr_ticket = ticketCounter++;
        tickets.unshift(ticket);
    }
    aggiornaTabella();
}
</script>

</body>
</html>
