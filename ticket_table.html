<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Table</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f5f5f5; padding:2rem;}
  table { width:100%; border-collapse:collapse;}
  th, td { border:1px solid #ddd; padding:0.5rem; text-align:center; }
  th { background:#333; color:white; }
  .priority-alta { background:#f87171; color:white; }
  .priority-media { background:#fbbf24; color:white; }
  .priority-bassa { background:#34d399; color:white; }
  button { cursor:pointer; }
</style>
</head>
<body>

<h1 class="text-3xl font-bold mb-4">Ticket Dashboard</h1>
<table>
<thead>
<tr>
<th>Modifica</th>
<th>Nr Ticket</th>
<th>Stato</th>
<th>Tipo</th>
<th>Bloccante</th>
<th>Priorit√†</th>
<th>Data Inserimento</th>
<th>Ambito</th>
<th>Menu</th>
<th>Titolo</th>
<th>Descrizione</th>
<th>Inserito da</th>
<th>In carico a</th>
<th>Data Inizio Prevista</th>
<th>Data Fine Prevista</th>
<th>Data Rilascio</th>
<th>Descrizione Soluzione</th>
<th>Data Segnalato</th>
<th>Data Preso in Carico</th>
<th>Data In Test</th>
<th>Data Completato</th>
</tr>
</thead>
<tbody id="ticketBody"></tbody>
</table>

<script>
// Configurazione GitHub
let repoPath = 'ticket/2026/ticket2026.json';
let token = prompt("Inserisci il token GitHub per leggere/scrivere il file JSON");

let tickets = [];

async function fetchTickets() {
    try {
        const res = await fetch(`https://api.github.com/repos/YOUR_USER/YOUR_REPO/contents/${repoPath}`,{
            headers: { "Authorization": `token ${token}` }
        });
        if(res.ok){
            const data = await res.json();
            tickets = JSON.parse(decodeURIComponent(escape(atob(data.content))));
            renderTable();
        } else { alert("Errore caricamento tickets"); }
    } catch(e) { console.error(e); }
}

function renderTable() {
    const tbody = document.getElementById('ticketBody');
    tbody.innerHTML = '';
    tickets.forEach((t,index)=>{
        const tr = document.createElement('tr');

        const editBtn = document.createElement('button');
        editBtn.innerHTML='<i class="fas fa-edit"></i>';
        editBtn.onclick = ()=>openTicketForm(index);

        tr.innerHTML=`
        <td>${editBtn.outerHTML}</td>
        <td>${t.nrTicket}</td>
        <td>${t.stato}</td>
        <td>${t.tipo}</td>
        <td>${t.bloccante}</td>
        <td class="${t.priorita=='Alta'?'priority-alta':t.priorita=='Media'?'priority-media':'priority-bassa'}">${t.priorita}</td>
        <td>${t.dataInserimento}</td>
        <td>${t.ambito}</td>
        <td>${t.menu}</td>
        <td>${t.titolo}</td>
        <td>${t.descrizione}</td>
        <td>${t.inseritoDa}</td>
        <td>${t.inCaricoA}</td>
        <td>${t.dataInizioPrevista}</td>
        <td>${t.dataFinePrevista}</td>
        <td>${t.dataRilascio}</td>
        <td>${t.descrizioneSoluzione}</td>
        <td>${t.dataSegnalato||''}</td>
        <td>${t.dataPresoInCarico||''}</td>
        <td>${t.dataInTest||''}</td>
        <td>${t.dataCompletato||''}</td>
        `;
        tbody.appendChild(tr);
    });
}

function openTicketForm(index){
    const ticket = tickets[index];
    localStorage.setItem('editTicketIndex',index);
    localStorage.setItem('editTicketData',JSON.stringify(ticket));
    window.open('ticket_form.html','_blank','width=800,height=900');
}

fetchTickets();
</script>
</body>
</html>
