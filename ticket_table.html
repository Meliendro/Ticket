<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket Table</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    .priority-Alta { background-color: #f87171; color: white; }
    .priority-Media { background-color: #fbbf24; color: white; }
    .priority-Bassa { background-color: #34d399; color: white; }
    .status-Segnalato { background-color: #93c5fd; color: white; }
    .status-PresoinCarico { background-color: #facc15; color: black; }
    .status-InTest { background-color: #f472b6; color: white; }
    .status-Rilasciato { background-color: #a78bfa; color: white; }
    .status-Completato { background-color: #34d399; color: white; }
    .icon-button { cursor:pointer; padding:4px; border-radius:4px; transition:0.2s; }
    .icon-button:hover { background-color:#eee; }
    table { table-layout: fixed; width: 100%; }
    th, td { text-align: center; vertical-align: middle; word-wrap: break-word; }
</style>
</head>
<body class="bg-gray-50 p-6">
<h1 class="text-3xl font-bold mb-6">Elenco Ticket</h1>
<button onclick="openTicketForm()" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
    <i class="fas fa-plus"></i> Nuovo Ticket
</button>

<table class="table-auto bg-white shadow rounded-lg overflow-hidden">
    <thead class="bg-gray-200">
        <tr>
            <th>Modifica</th>
            <th>Nr Ticket</th>
            <th>STATO</th>
            <th>Tipo</th>
            <th>Bloccante</th>
            <th>Priorità</th>
            <th>Data Inserimento</th>
            <th>Ambito</th>
            <th>Menu</th>
            <th>Titolo</th>
            <th>Descrizione</th>
            <th>Inserito da</th>
            <th>In carico a</th>
            <th>Data Inizio Prevista</th>
            <th>Data Fine Prevista</th>
            <th>Data Rilascio</th>
            <th>Descrizione Attività</th>
            <th>Data Segnalato</th>
            <th>Data Preso in Carico</th>
            <th>Data In Test</th>
            <th>Data Completato</th>
        </tr>
    </thead>
    <tbody id="ticketTableBody"></tbody>
</table>

<script>
let tickets = JSON.parse(localStorage.getItem('tickets')) || [];

function renderTable() {
    const tbody = document.getElementById('ticketTableBody');
    tbody.innerHTML = '';
    tickets.forEach((t, idx) => {
        const tr = document.createElement('tr');
        tr.className = "border-b";
        tr.innerHTML = `
            <td>
                <span class="icon-button text-blue-600" onclick="editTicket(${idx})"><i class="fas fa-edit"></i></span>
            </td>
            <td>${t.ticketNumber}</td>
            <td class="status-${t.stato.replace(/ /g,'')}">${t.stato}</td>
            <td>${t.tipo}</td>
            <td>${t.bloccante}</td>
            <td class="priority-${t.priorita} font-bold">${t.priorita}</td>
            <td>${t.dataInserimento}</td>
            <td>${t.ambito}</td>
            <td>${t.menu}</td>
            <td>${t.titolo}</td>
            <td>${t.descrizione}</td>
            <td>${t.inseritoDa}</td>
            <td>${t.inCaricoA}</td>
            <td>${t.dataInizioPrevista}</td>
            <td>${t.dataFinePrevista}</td>
            <td>${t.dataRilascio}</td>
            <td>${t.descrizioneAttivita}</td>
            <td>${t.dataSegnalato || ''}</td>
            <td>${t.dataPresoInCarico || ''}</td>
            <td>${t.dataInTest || ''}</td>
            <td>${t.dataCompletato || ''}</td>
        `;
        tbody.appendChild(tr);
    });
}

function openTicketForm() {
    localStorage.removeItem('editIndex'); // nuovo ticket
    window.open('ticket_form.html', '_blank', 'width=900,height=800');
}

function editTicket(idx) {
    localStorage.setItem('editIndex', idx);
    window.open('ticket_form.html', '_blank', 'width=900,height=800');
}

window.addEventListener('focus', renderTable);
renderTable();
</script>
</body>
</html>
