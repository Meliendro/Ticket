<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ticket 2026</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>

<style>
body { background:#f3f4f6; }

table { font-size:13px; }

th {
    background:#111827;
    color:white;
    position:sticky;
    top:0;
    z-index:5;
}

.group-header {
    background: linear-gradient(90deg, #1f2937, #111827);
    color:white;
    font-weight:600;
    cursor:pointer;
}

.group-header:hover {
    background: linear-gradient(90deg, #374151, #1f2937);
}

.group-content {
    overflow:hidden;
    transition:max-height 0.4s ease, opacity 0.3s ease;
}

.group-content.collapsed {
    max-height:0;
    opacity:0;
}

.group-content.expanded {
    opacity:1;
}

.toggle-icon {
    transition: transform 0.3s ease;
}

.rotate {
    transform: rotate(-90deg);
}

td { white-space:nowrap; }

.priority-Alta { color:#dc2626; font-weight:bold; }
.priority-Media { color:#d97706; }
.priority-Bassa { color:#16a34a; }

</style>
</head>

<body class="p-6">

<div class="bg-white shadow-xl rounded-2xl p-6">

<div class="flex justify-between items-center mb-4">
<h1 class="text-2xl font-bold text-gray-800">Gestione Ticket 2026</h1>

<div class="flex gap-3">
<select id="filterStato" class="border p-2 rounded">
<option value="">Tutti Stati</option>
</select>

<select id="filterPriorita" class="border p-2 rounded">
<option value="">Tutte Priorità</option>
<option>Alta</option>
<option>Media</option>
<option>Bassa</option>
</select>

<select id="filterBloccante" class="border p-2 rounded">
<option value="">Bloccante?</option>
<option>SI</option>
<option>NO</option>
</select>

<button onclick="loadTickets()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
<i class="fas fa-rotate mr-2"></i>Ricarica
</button>
</div>
</div>

<div class="overflow-auto rounded-xl border">
<table class="min-w-full">
<thead>
<tr>
<th></th>
<th>Nr</th>
<th>Stato</th>
<th>Tipo</th>
<th>Blocc</th>
<th>Priorità</th>
<th>Data Ins</th>
<th>Ambito</th>
<th>Menu</th>
<th>Titolo</th>
<th>Descrizione</th>
<th>Inserito</th>
<th>In Carico</th>
<th>Inizio Prev</th>
<th>Fine Prev</th>
<th>Rilascio</th>
<th>Attività</th>
<th>Segnalato</th>
<th>Preso Carico</th>
<th>Rilasciato</th>
<th>Test</th>
<th>Completato</th>
</tr>
</thead>
<tbody id="ticketBody"></tbody>
</table>
</div>
</div>

<script>

const GITHUB_RAW_URL = "https://raw.githubusercontent.com/meliendro/ticket/main/ticket/2026/ticket2026.json";

let tickets = [];

async function loadTickets(){
    try{
        const res = await fetch(GITHUB_RAW_URL);
        if(!res.ok) throw new Error("Errore caricamento");
        tickets = await res.json();

        tickets.sort((a,b)=> b.nrTicket - a.nrTicket);

        populateStatoFilter();
        applyFilters();
    }catch(e){
        alert("Errore connessione o file non trovato su GitHub");
        console.error(e);
    }
}

function populateStatoFilter(){
    const stati = [...new Set(tickets.map(t=>t.stato))];
    const select = document.getElementById("filterStato");
    select.innerHTML='<option value="">Tutti Stati</option>';
    stati.forEach(s=>{
        select.innerHTML+=`<option>${s}</option>`;
    });
}

function applyFilters(){
    let filtered = [...tickets];

    const stato = document.getElementById("filterStato").value;
    const priorita = document.getElementById("filterPriorita").value;
    const blocc = document.getElementById("filterBloccante").value;

    if(stato) filtered = filtered.filter(t=>t.stato===stato);
    if(priorita) filtered = filtered.filter(t=>t.priorita===priorita);
    if(blocc) filtered = filtered.filter(t=>t.bloccante===blocc);

    renderTable(filtered);
}

document.getElementById("filterStato").onchange=applyFilters;
document.getElementById("filterPriorita").onchange=applyFilters;
document.getElementById("filterBloccante").onchange=applyFilters;

function renderTable(data){

    const tbody = document.getElementById("ticketBody");
    tbody.innerHTML="";

    const grouped = {};
    data.forEach(t=>{
        if(!grouped[t.stato]) grouped[t.stato]=[];
        grouped[t.stato].push(t);
    });

    Object.keys(grouped).forEach(stato=>{

        const header = document.createElement("tr");
        header.className="group-header";
        header.innerHTML=`
        <td colspan="22" class="px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fas fa-chevron-down toggle-icon"></i>
                <span>${stato}</span>
                <span class="bg-blue-500 text-xs px-2 py-1 rounded-full">
                ${grouped[stato].length}
                </span>
            </div>
        </td>`;
        tbody.appendChild(header);

        const wrapper=document.createElement("tbody");
        wrapper.className="group-content expanded";

        grouped[stato].forEach(t=>{

            const tr=document.createElement("tr");
            tr.className="hover:bg-gray-100 transition";

            tr.innerHTML=`
<td></td>
<td>${t.nrTicket}</td>
<td>${t.stato}</td>
<td>${t.tipo||""}</td>
<td>${t.bloccante||""}</td>
<td class="priority-${t.priorita}">${t.priorita||""}</td>
<td>${t.dataInserimento||""}</td>
<td>${t.ambito||""}</td>
<td>${t.menu||""}</td>
<td>${t.titolo||""}</td>
<td>${t.descrizione||""}</td>
<td>${t.inseritoDa||""}</td>
<td>${t.inCaricoA||""}</td>
<td>${t.dataInizioPrevista||""}</td>
<td>${t.dataFinePrevista||""}</td>
<td>${t.dataRilascio||""}</td>
<td>${t.descrAttivita||""}</td>
<td>${t.dataSegnalato||""}</td>
<td>${t.dataPresoInCarico||""}</td>
<td>${t.dataRilasciato||""}</td>
<td>${t.dataInTest||""}</td>
<td>${t.dataCompletato||""}</td>
`;
            wrapper.appendChild(tr);
        });

        tbody.appendChild(wrapper);

        header.onclick=function(){
            const icon=header.querySelector(".toggle-icon");
            if(wrapper.classList.contains("collapsed")){
                wrapper.classList.remove("collapsed");
                wrapper.classList.add("expanded");
                wrapper.style.maxHeight=wrapper.scrollHeight+"px";
                icon.classList.remove("rotate");
            }else{
                wrapper.classList.add("collapsed");
                wrapper.classList.remove("expanded");
                wrapper.style.maxHeight="0px";
                icon.classList.add("rotate");
            }
        };

        wrapper.style.maxHeight=wrapper.scrollHeight+"px";
    });
}

loadTickets();

</script>

</body>
</html>
